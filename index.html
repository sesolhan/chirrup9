<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>chirrup9</title>
<style>
  :root{
  --bg:#e6e6e6; --panel:#e6e6e6; --card:#b9dcfe; --fg:#111827; --muted:#6b7280; --line:#cfd4dc;
}
*{box-sizing:border-box}

/* ▼ 사방 배경/여백 제거 + 가로스크롤 방지 */
html, body { height:100%; }
body{
  margin:0;
  background:transparent;            /* 바깥(사방) 배경 제거 */
  color:var(--fg);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif;
  overflow-x:hidden;
}

/* ▼ 중앙 2열을 화면 전체로 펼치기 */
.stage{
  width:100vw;                        /* 전체 너비 */
  max-width:none;                     /* 고정폭 해제 */
  margin:0;
  padding:0;                          /* 바깥 패딩 제거 */
  display:grid;
  gap:0;
  grid-template-columns:minmax(360px,560px) 1fr; 
  align-items:start;
}

/* 왼쪽 패널(회색) – 내부 여백은 필요에 맞게 조절 */
.left{
  background:var(--panel);
  border-radius:0;
  padding: 30px;;
  min-height:100vh;
}

/* 오른쪽 미디어(초록) – 화면 높이 꽉, 상단 고정 */
.right{
  background:#bbfdc8;
  color:#fff;
  min-height:100vh;                   /* 전체 높이 */
  display:flex; align-items:center; justify-content:center;
  position:sticky; top:0;             /* 상단에 고정 */
}
.right .placeholder{opacity:.7; letter-spacing:.02em}

/* 스토리형 태그(동그라미) */
.stories{display:flex; gap:16px; padding:6px 0 18px; align-items:center}
.dot{width:64px;height:64px;border-radius:999px;background:#bfbfbf;display:flex;align-items:center;justify-content:center}
.dot span{font-size:13px}

/* 날짜 */
.date{margin:18px 0 8px; font-weight:700}

/* 카드 */
article.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:16px;
  padding:16px 18px;
  margin:10px 0 22px;
}
article h2{margin:0 0 8px; font-size:18px}
.meta{font-size:12px; color:var(--muted); margin-bottom:8px; display:flex; gap:8px; align-items:center}
.pills{display:flex; gap:8px; flex-wrap:wrap}
.pill{font-size:12px; padding:4px 8px; border-radius:999px; border:1px dashed #999; background:#e6e6e6}
.content{margin-top:8px; white-space:pre-wrap; line-height:1.55; color:#1f2937}

/* 반응형: 모바일은 세로 스택 */
@media (max-width:900px){
  .stage{grid-template-columns:1fr}
  .right{position:static; min-height:240px; margin-top:0}
}

</style>
</head>
<body>
  <main class="stage">
    <!-- 왼쪽: 태그/날짜/카드 -->
    <section class="left">
      <div class="stories" id="storyBar">
        <div class="dot"><span>태그</span></div>
        <div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
      </div>

      <div id="list">
        <!-- 시트에서 불러오면 이 아래로 날짜와 카드가 렌더됩니다 -->
      </div>
    </section>

    <!-- 오른쪽: 이미지/영상 -->
    <aside class="right" id="media">
    </aside>
  </main>

<script>
/* ===== 시트 연결 설정 ===== */
const SHEET_ID   = "1i8VMQ2ZkSEJp9H0Ct9tP-61DF_OF2KJuxb31btuHgSE";  // ← 스프레드시트 ID로 교체
const SHEET_NAME = "";                    // 탭 이름이 있으면 예: "블로그"
const GVIZ = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json` +
             (SHEET_NAME ? `&sheet=${encodeURIComponent(SHEET_NAME)}` : "");

/* ===== 데이터 파싱(한국어/영어 헤더 자동 인식) ===== */
const headerMap = {
  id:['id','아이디'], title:['title','제목'], body:['body','본문','내용','content'],
  tags:['tags','태그'], likes:['likes','좋아요','like'], date:['date','날짜','일자'],
  published:['published','공개','노출','게시'], media:['media','이미지','영상','미디어','image','video','url']
};
function parseGviz(text){
  const json = JSON.parse(text.substring(47).slice(0,-2));
  const labels = json.table.cols.map(c=>String(c.label||'').toLowerCase().trim());
  const find = key => {
    const idx = labels.findIndex(l=>headerMap[key].includes(l));
    return idx===-1 ? null : idx;
  };
  const idx = {
    id:find('id'), title:find('title'), body:find('body'), tags:find('tags'),
    likes:find('likes'), date:find('date'), published:find('published'), media:find('media')
  };
  const rows = json.table.rows.map(r=>{
    const get = i => (i===null? "" : (r.c[i]?.f ?? r.c[i]?.v ?? ""));
    const pubRaw = get(idx.published);
    const published = (idx.published===null) ? true
      : (String(pubRaw).toLowerCase()==="true" || pubRaw===true);
    return {
      id:String(get(idx.id)||"").trim(),
      title:String(get(idx.title)||"").trim(),
      body:String(get(idx.body)||"").trim(),
      tags:String(get(idx.tags)||"").split(",").map(s=>s.trim()).filter(Boolean),
      likes:Number(get(idx.likes)||0),
      date:String(get(idx.date)||"").trim(),
      media:String(get(idx.media)||"").trim(),
      published
    };
  });
  return rows.filter(r=>r.published && r.title);
}

/* ===== 렌더 ===== */
const $list = document.getElementById('list');
const $media = document.getElementById('media');

function formatKDate(s){
  // "YYYY-MM-DD" 또는 "YYYY/M/D"를 "YYYY년 M월 D일"로 가볍게 포맷
  const m = String(s||"").match(/^(\d{4})[-/](\d{1,2})[-/](\d{1,2})/);
  if(!m) return s || "날짜";
  return `${m[1]}년 ${Number(m[2])}월 ${Number(m[3])}일`;
}
function groupByDate(posts){
  const map = new Map();
  posts.forEach(p=>{
    const key = p.date || "날짜";
    if(!map.has(key)) map.set(key, []);
    map.get(key).push(p);
  });
  return Array.from(map.entries()).sort((a,b)=> (b[0]||"").localeCompare(a[0]||""));
}
function render(posts){
  if(!posts.length){ $list.innerHTML = `<div style="color:#6b7280">게시물이 없습니다.</div>`; return; }

  const groups = groupByDate(posts);
  $list.innerHTML = groups.map(([date, items])=>{
    const cards = items.map(p=>{
      const pid = p.id || `post-${Math.random().toString(36).slice(2)}`;
      const tags = p.tags.map(t=>`<span class="pill">#${t}</span>`).join("");
      return `
        <article class="card" data-id="${pid}" data-media="${encodeURIComponent(p.media)}">
          <h2>${p.title}</h2>
          <div class="meta">
            <span class="pill">좋아요 ${p.likes ?? 0}</span>
            <span class="pills">${tags}</span>
          </div>
          <div class="content">${p.body}</div>
        </article>
      `;
    }).join("");
    return `<div class="date">${formatKDate(date)}</div>${cards}`;
  }).join("");
  // 초기 미디어: 첫 카드
  const first = document.querySelector('article.card');
  if(first) showMedia(first);
}

/* ===== 미디어 표시(오른쪽) ===== */
function showMedia($article){
  const url = decodeURIComponent($article.getAttribute('data-media')||"");
  if(!url){ $media.innerHTML = `<div class="placeholder">이미지영역</div>`; return; }
  if(/(youtube\.com\/watch\?v=|youtu\.be\/)/.test(url)){
    const id = url.match(/(?:v=|youtu\.be\/)([^&?/]+)/)?.[1] || "";
    $media.innerHTML = `<iframe width="100%" height="100%" style="aspect-ratio:16/9;border:0"
      src="https://www.youtube-nocookie.com/embed/${id}" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
  }else if(/\.(mp4|webm|ogg)(\?.*)?$/i.test(url)){
    $media.innerHTML = `<video controls playsinline style="width:100%;height:auto" src="${url}"></video>`;
  }else{
    $media.innerHTML = `<img src="${url}" alt="" style="max-width:100%;height:auto;display:block" />`;
  }
}

/* 카드 클릭 → 오른쪽에 미디어 표시 */
document.addEventListener('click', e=>{
  const card = e.target.closest('article.card');
  if(card) showMedia(card);
});

/* ===== 데이터 로드 ===== */
(async function(){
  try{
    const res = await fetch(GVIZ);
    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    const text = await res.text();
    const rows = parseGviz(text).sort((a,b)=> (b.date||"").localeCompare(a.date||""));
    render(rows);
  }catch(err){
    $list.innerHTML = `<div style="color:#6b7280">시트를 불러오지 못했습니다. (웹에 게시/탭/헤더 확인) <br><small>${String(err)}</small></div>`;
    console.error(err);
  }
})();
</script>
</body>
</html>
